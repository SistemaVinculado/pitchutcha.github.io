document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("theme-toggle"),t=document.body;e&&e.addEventListener("click",()=>{const e=t.classList.contains("dark")?"light":"dark";localStorage.setItem("theme",e),"dark"===e?t.classList.add("dark"):t.classList.remove("dark")});const n=localStorage.getItem("theme")||"light";"dark"===n?t.classList.add("dark"):t.classList.remove("dark");const o=document.querySelectorAll(".header-search-form, .main-search-form");function c(e){e.preventDefault();const t=this.querySelector('input[type="search"], input[type="text"]');if(t){const n=t.value.trim();n&&(window.location.href=`/pitchutcha.github.io/search.html?q=${encodeURIComponent(n)}`)}}o.forEach(e=>{e.addEventListener("submit",c)});const a=document.getElementById("search-input");if(a){const i=new URLSearchParams(window.location.search).get("q");i&&(a.value=i,a.dispatchEvent(new Event("input",{bubbles:!0})))}const s=document.getElementById("homepage-status-indicator"),r=document.getElementById("homepage-status-text");if(s&&r){const l=e=>{const t=s.querySelector(".ping-pulse"),n=s.querySelector(".relative.inline-flex");t.className="ping-pulse",n.className="relative inline-flex rounded-full h-3 w-3";const o={ok:{pulse:"ping-green",dot:"bg-green-500",text:"Todos os sistemas operacionais"},down:{pulse:"ping-red",dot:"bg-red-500",text:"Instabilidade nos sistemas"},error:{pulse:"ping-yellow",dot:"bg-yellow-500",text:"Não foi possível verificar"}},c=o[e]||o.error;t.classList.add(c.pulse),n.classList.add(c.dot),r.textContent=c.text};fetch("uptime-data.json?cache_bust="+Date.now()).then(e=>e.ok?e.json():Promise.reject("Network response was not ok")).then(e=>{const t=e?.monitors?.[0];2===t?.status?l("ok"):8===t?.status||9===t?.status?l("down"):l("error")}).catch(e=>{console.error("Falha ao buscar status para a homepage:",e),l("error")})}const u=window.location.pathname.split("/").pop();if(u){const d=document.querySelectorAll("nav a");d.forEach(e=>{const t=e.getAttribute("href").split("/").pop();u===t&&(e.style.color="var(--primary-color)",e.style.fontWeight="600")})}const m=document.createElement("div");m.id="search-modal-overlay",m.className="search-modal-overlay",m.innerHTML=`<div class="search-modal" role="dialog" aria-modal="true" aria-labelledby="search-modal-title"><div class="search-modal-input-wrapper"><span class="material-symbols-outlined text-gray-400">search</span><input type="text" id="search-modal-input" class="search-modal-input" placeholder="Pesquisar artigos..." autocomplete="off"></div><div id="search-modal-results" class="search-modal-results"></div><div class="search-modal-footer"><span>Navegar com <kbd>↑</kbd> <kbd>↓</kbd></span><span>Abrir com <kbd>Enter</kbd></span><span>Fechar com <kbd>Esc</kbd></span></div></div>`,document.body.appendChild(m);const p=document.getElementById("search-modal-input"),y=document.getElementById("search-modal-results");let h,f=[];const b={keys:["title","excerpt"],includeMatches:!0,minMatchCharLength:2,threshold:.3,ignoreLocation:!0};async function g(){try{const e=await fetch("/pitchutcha.github.io/search.json?cache_bust="+Date.now());if(!e.ok)throw new Error("Falha ao carregar search.json para o modal");f=await e.json(),h=new Fuse(f,b)}catch(e){console.error(e)}}function v(e,t,n){let o=[],c=0;const a=t.filter(e=>e.key===n);return a.forEach(t=>{t.indices.forEach(t=>{const n=t[0],a=t[1]+1;n>c&&o.push(e.substring(c,n)),o.push(`<mark>${e.substring(n,a)}</mark>`),c=a})}),c<e.length&&o.push(e.substring(c)),o.join("")}function w(){const e=p.value.trim();let t;t=e.length<b.minMatchCharLength?[]:h.search(e),y.innerHTML="",t.length>0?t.slice(0,10).forEach(({item:e,matches:t})=>{const n=document.createElement("a");n.href=e.url,n.innerHTML=`<div class="title">${v(e.title,t,"title")}</div><div class="excerpt">${v(e.excerpt,t,"excerpt")}</div>`,y.appendChild(n)}):y.innerHTML=`<p class="p-4 text-center text-[var(--text-secondary)]">Nenhum resultado encontrado.</p>`}function E(e){"Escape"===e.key&&m.classList.remove("visible")}g(),p.addEventListener("input",w),window.addEventListener("keydown",e=>{"k"===e.key&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),m.classList.add("visible"),p.focus()),"/"===e.key&&"INPUT"!==document.activeElement.tagName&&"TEXTAREA"!==document.activeElement.tagName&&(e.preventDefault(),m.classList.add("visible"),p.focus()),E(e)}),m.addEventListener("click",e=>{e.target===m&&m.classList.remove("visible")})});
