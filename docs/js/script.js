document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("theme-toggle");e&&e.addEventListener("click",()=>{const e=document.documentElement.classList.contains("dark")?"light":"dark";localStorage.setItem("theme",e),"dark"===e?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")});const t=document.querySelectorAll(".header-search-form, .main-search-form");function o(e){e.preventDefault();const o=this.querySelector('input[type="search"], input[type="text"]');if(o){const c=o.value.trim();c&&(window.location.href=`search.html?q=${encodeURIComponent(c)}`)}}t.forEach(e=>{e.addEventListener("submit",o)});const c=document.getElementById("search-input");if(c){const a=new URLSearchParams(window.location.search).get("q");a&&(c.value=a,c.dispatchEvent(new Event("input",{bubbles:!0})))}const n=document.getElementById("homepage-status-indicator"),s=document.getElementById("homepage-status-text");if(n&&s){const r=e=>{const t=n.querySelector(".ping-pulse"),o=n.querySelector(".relative.inline-flex");t.className="ping-pulse",o.className="relative inline-flex rounded-full h-3 w-3";const c={ok:{pulse:"ping-green",dot:"bg-green-500",text:"Todos os sistemas operacionais"},down:{pulse:"ping-red",dot:"bg-red-500",text:"Instabilidade nos sistemas"},error:{pulse:"ping-yellow",dot:"bg-yellow-500",text:"Não foi possível verificar"}},a=c[e]||c.error;t.classList.add(a.pulse),o.classList.add(a.dot),s.textContent=a.text};fetch("uptime-data.json?cache_bust="+Date.now()).then(e=>e.ok?e.json():Promise.reject("Network response was not ok")).then(e=>{const t=e?.monitors?.[0];2===t?.status?r("ok"):8===t?.status||9===t?.status?r("down"):r("error")}).catch(e=>{console.error("Falha ao buscar status para a homepage:",e),r("error")})}const i=window.location.pathname.split("/").pop();if(i){const l=document.querySelectorAll("nav a");l.forEach(e=>{const t=e.getAttribute("href").split("/").pop();i===t&&(e.style.color="var(--primary-color)",e.style.fontWeight="600")})}const d=document.createElement("div");d.id="search-modal-overlay",d.className="search-modal-overlay",d.innerHTML=`<div class="search-modal" role="dialog" aria-modal="true" aria-labelledby="search-modal-title"><div class="search-modal-input-wrapper"><span class="material-symbols-outlined text-gray-400">search</span><input type="text" id="search-modal-input" class="search-modal-input" placeholder="Pesquisar artigos..." autocomplete="off"></div><div id="search-modal-results" class="search-modal-results"></div><div class="search-modal-footer"><span>Navegar com <kbd>↑</kbd> <kbd>↓</kbd></span><span>Abrir com <kbd>Enter</kbd></span><span>Fechar com <kbd>Esc</kbd></span></div></div>`,document.body.appendChild(d);const u=document.getElementById("search-modal-input"),m=document.getElementById("search-modal-results");let p,h=[];const f={keys:["title","excerpt"],includeMatches:!0,minMatchCharLength:2,threshold:.3,ignoreLocation:!0};async function y(){try{const e=await fetch("search.json?cache_bust="+Date.now());if(!e.ok)throw new Error("Falha ao carregar search.json para o modal");h=await e.json(),p=new Fuse(h,f)}catch(e){console.error(e)}}function b(e,t,o){let c=[],a=0;const n=t.filter(e=>e.key===o);return n.forEach(t=>{t.indices.forEach(t=>{const o=t[0],n=t[1]+1;o>a&&c.push(e.substring(a,o)),c.push(`<mark>${e.substring(o,n)}</mark>`),a=n})}),a<e.length&&c.push(e.substring(a)),c.join("")}function g(){const e=u.value.trim();let t;t=e.length<f.minMatchCharLength?[]:p.search(e),m.innerHTML="",t.length>0?t.slice(0,10).forEach(({item:e,matches:t})=>{const o=document.createElement("a");o.href=e.url,o.innerHTML=`<div class="title">${b(e.title,t,"title")}</div><div class="excerpt">${b(e.excerpt,t,"excerpt")}</div>`,m.appendChild(o)}):m.innerHTML=`<p class="p-4 text-center text-[var(--text-secondary)]">Nenhum resultado encontrado.</p>`}function v(e){"Escape"===e.key&&d.classList.remove("visible")}y(),u.addEventListener("input",g),window.addEventListener("keydown",e=>{"k"===e.key&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),d.classList.add("visible"),u.focus()),"/"===e.key&&"INPUT"!==document.activeElement.tagName&&"TEXTAREA"!==document.activeElement.tagName&&(e.preventDefault(),d.classList.add("visible"),u.focus()),v(e)}),d.addEventListener("click",e=>{e.target===d&&d.classList.remove("visible")})});
