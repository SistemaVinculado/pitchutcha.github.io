document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector('meta[name="base-url"]')?.content||"",t=document.getElementById("search-input"),n=document.getElementById("results-container"),o=document.getElementById("results-count"),c=document.getElementById("autocomplete-suggestions"),s=document.querySelectorAll('input[data-filter="category"]');let a,r=[];const l={keys:["title","excerpt"],includeMatches:!0,minMatchCharLength:2,threshold:.4,ignoreLocation:!0,useExtendedSearch:!0};async function i(){try{const t=await fetch(`${e}search.json?cache_bust=`+Date.now());if(!t.ok)throw new Error("Falha ao carregar search.json");r=await t.json(),a=new Fuse(r,l);const i=new URLSearchParams(window.location.search).get("q");i&&(t.value=i),d()}catch(t){console.error(t),o.textContent="Erro ao carregar artigos."}}function u(e,t,o){let c=[],s=0;const a=t.filter(e=>e.key===o);return a.forEach(t=>{t.indices.forEach(t=>{const o=t[0],a=t[1]+1;o>s&&c.push(e.substring(s,o)),c.push(`<mark>${e.substring(o,a)}</mark>`),s=a})}),s<e.length&&c.push(e.substring(s)),c.join("")}function d(){if(!a)return;const e=t.value.trim(),i=Array.from(s).filter(e=>e.checked).map(e=>e.value.trim());let d=[];e.length<l.minMatchCharLength?d=r.filter(e=>0===i.length||e.category&&i.includes(e.category.trim())).map(e=>({item:e,matches:[]})):(d=a.search(e),i.length>0&&(d=d.filter(({item:e})=>e.category&&i.includes(e.category.trim())))),(e=>{n.innerHTML="",0===e.length?o.textContent="Nenhum resultado encontrado.":(o.textContent=`Mostrando ${e.length} resultados.`,e.forEach(({item:e,matches:t})=>{const o=document.createElement("div");o.className="bg-[var(--background-primary)] p-6 rounded-md shadow-sm border border-[var(--secondary-color)] hover:shadow-md transition-shadow",o.innerHTML=`
                    <a class="block" href="${e.url}">
                        <h3 class="text-lg font-semibold text-[var(--text-primary)] hover:text-[var(--primary-color)]">${u(e.title,t,"title")}</h3>
                        <p class="text-sm text-[var(--text-secondary)] mt-1">Categoria: <span class="font-medium text-[var(--text-primary)]">${e.category}</span></p>
                        <p class="text-[var(--text-secondary)] mt-2 text-sm">${u(e.excerpt,t,"excerpt")}</p>
                    </a>
                `,n.appendChild(o)}))})(d),e?(e=>{c.innerHTML="",0!==e.length?(c.style.display="block",(()=>{const t=e.slice(0,5),o=document.createElement("ul");o.className="absolute w-full bg-[var(--background-primary)] border border-[var(--secondary-color)] rounded-md mt-1 shadow-lg z-10",t.forEach(({item:e,matches:t})=>{const c=document.createElement("li"),n=document.createElement("a");n.href=e.url,n.className="block p-3 hover:bg-[var(--background-secondary)]",n.innerHTML=`<span class="font-semibold">${u(e.title,t,"title")}</span><br><span class="text-sm text-[var(--text-secondary)]">${u(e.excerpt,t,"excerpt")}</span>`,c.appendChild(n),o.appendChild(c)}),c.appendChild(o)})()):c.style.display="none"})(d):(c.innerHTML="",c.style.display="none")}t&&(t.addEventListener("input",d),s.forEach(e=>{e.addEventListener("change",d)}),document.addEventListener("click",e=>{t.contains(e.target)||(c.style.display="none")}),i())});
