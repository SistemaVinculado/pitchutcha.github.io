document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("search-input"),t=document.getElementById("results-container"),n=document.getElementById("results-count"),o=document.getElementById("autocomplete-suggestions"),c=document.querySelectorAll('input[data-filter="category"]');let a,s=[];const r={keys:["title","excerpt"],includeMatches:!0,minMatchCharLength:2,threshold:.4,ignoreLocation:!0,useExtendedSearch:!0};async function l(){try{const i=await fetch("search.json");if(!i.ok)throw new Error("Falha ao carregar search.json");s=await i.json(),a=new Fuse(s,r);const u=new URLSearchParams(window.location.search).get("q");u&&(e.value=u),d()}catch(i){console.error(i),n.textContent="Erro ao carregar artigos."}}function u(e,t,n){let o,c,a,s,r,l,u=[],d=0;const f=t.filter(e=>e.key===n);return f.forEach(t=>{t.indices.forEach((t,n)=>{const o=t[0],c=t[1]+1;o>d&&u.push(e.substring(d,o)),u.push(`<mark>${e.substring(o,c)}</mark>`),d=c})}),d<e.length&&u.push(e.substring(d)),u.join("")}function d(){if(!a)return;const s=e.value.trim(),l=Array.from(c).filter(e=>e.checked).map(e=>e.value.trim());let d=[];s.length<r.minMatchCharLength?d=s.filter(e=>0===l.length||e.category&&l.includes(e.category.trim())).map(e=>({item:e,matches:[]})):(d=a.search(s),l.length>0&&(d=d.filter(({item:e})=>e.category&&l.includes(e.category.trim())))),(e=>{t.innerHTML="",0===e.length?n.textContent="Nenhum resultado encontrado.":(n.textContent=`Mostrando ${e.length} resultados.`,e.forEach(({item:e,matches:n})=>{const o=document.createElement("div");o.className="bg-[var(--background-primary)] p-6 rounded-md shadow-sm border border-[var(--secondary-color)] hover:shadow-md transition-shadow",o.innerHTML=`
                    <a class="block" href="${e.url}">
                        <h3 class="text-lg font-semibold text-[var(--text-primary)] hover:text-[var(--primary-color)]">${u(e.title,n,"title")}</h3>
                        <p class="text-sm text-[var(--text-secondary)] mt-1">Categoria: <span class="font-medium text-[var(--text-primary)]">${e.category}</span></p>
                        <p class="text-[var(--text-secondary)] mt-2 text-sm">${u(e.excerpt,n,"excerpt")}</p>
                    </a>
                `,t.appendChild(o)}))})(d),s?(e=>{o.innerHTML="",0!==e.length?(o.style.display="block",(()=>{const t=e.slice(0,5),n=document.createElement("ul");n.className="absolute w-full bg-[var(--background-primary)] border border-[var(--secondary-color)] rounded-md mt-1 shadow-lg z-10",t.forEach(({item:e,matches:t})=>{const o=document.createElement("li"),c=document.createElement("a");c.href=e.url,c.className="block p-3 hover:bg-[var(--background-secondary)]",c.innerHTML=`<span class="font-semibold">${u(e.title,t,"title")}</span><br><span class="text-sm text-[var(--text-secondary)]">${u(e.excerpt,t,"excerpt")}</span>`,o.appendChild(c),n.appendChild(o)}),o.appendChild(n)})()):o.style.display="none"})(d):(o.innerHTML="",o.style.display="none")}e&&(e.addEventListener("input",d),c.forEach(e=>{e.addEventListener("change",d)}),document.addEventListener("click",t=>{e.contains(t.target)||(o.style.display="none")}),l())});
