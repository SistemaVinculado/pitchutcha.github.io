document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("search-input"),t=document.getElementById("results-container"),n=document.getElementById("results-count"),o=document.getElementById("autocomplete-suggestions"),c=document.querySelectorAll('input[data-filter="category"]');let a,s=[];const r={keys:["title","excerpt"],includeMatches:!0,minMatchCharLength:2,threshold:.4,ignoreLocation:!0,useExtendedSearch:!0};async function l(){try{const i=await fetch("search.json?cache_bust="+Date.now());if(!i.ok)throw new Error("Falha ao carregar search.json");s=await i.json(),a=new Fuse(s,r);const u=new URLSearchParams(window.location.search).get("q");u&&(e.value=u),d()}catch(i){console.error(i),n.textContent="Erro ao carregar artigos."}}function u(e,t,n){let o=[],c=0;const a=t.filter(e=>e.key===n);return a.forEach(t=>{t.indices.forEach(t=>{const n=t[0],a=t[1]+1;n>c&&o.push(e.substring(c,n)),o.push(`<mark>${e.substring(n,a)}</mark>`),c=a})}),c<e.length&&o.push(e.substring(c)),o.join("")}function d(){if(!a)return;const l=e.value.trim(),d=Array.from(c).filter(e=>e.checked).map(e=>e.value.trim());let f=[];l.length<r.minMatchCharLength?f=s.filter(e=>0===d.length||e.category&&d.includes(e.category.trim())).map(e=>({item:e,matches:[]})):(f=a.search(l),d.length>0&&(f=f.filter(({item:e})=>e.category&&d.includes(e.category.trim())))),(e=>{t.innerHTML="",0===e.length?n.textContent="Nenhum resultado encontrado.":(n.textContent=`Mostrando ${e.length} resultados.`,e.forEach(({item:e,matches:n})=>{const c=document.createElement("div");c.className="bg-[var(--background-primary)] p-6 rounded-md shadow-sm border border-[var(--secondary-color)] hover:shadow-md transition-shadow",c.innerHTML=`
                    <a class="block" href="${e.url}">
                        <h3 class="text-lg font-semibold text-[var(--text-primary)] hover:text-[var(--primary-color)]">${u(e.title,n,"title")}</h3>
                        <p class="text-sm text-[var(--text-secondary)] mt-1">Categoria: <span class="font-medium text-[var(--text-primary)]">${e.category}</span></p>
                        <p class="text-[var(--text-secondary)] mt-2 text-sm">${u(e.excerpt,n,"excerpt")}</p>
                    </a>
                `,t.appendChild(c)}))})(f),l?(e=>{o.innerHTML="",0!==e.length?(o.style.display="block",(()=>{const t=e.slice(0,5),n=document.createElement("ul");n.className="absolute w-full bg-[var(--background-primary)] border border-[var(--secondary-color)] rounded-md mt-1 shadow-lg z-10",t.forEach(({item:e,matches:t})=>{const o=document.createElement("li"),c=document.createElement("a");c.href=e.url,c.className="block p-3 hover:bg-[var(--background-secondary)]",c.innerHTML=`<span class="font-semibold">${u(e.title,t,"title")}</span><br><span class="text-sm text-[var(--text-secondary)]">${u(e.excerpt,t,"excerpt")}</span>`,o.appendChild(c),n.appendChild(o)}),o.appendChild(n)})()):o.style.display="none"})(f):(o.innerHTML="",o.style.display="none")}e&&(e.addEventListener("input",d),c.forEach(e=>{e.addEventListener("change",d)}),document.addEventListener("click",t=>{e.contains(t.target)||(o.style.display="none")}),l())});
